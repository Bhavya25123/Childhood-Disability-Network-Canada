# Deployment Handoff Guide

This guide outlines how to transfer ownership of the CDAH stack to a client and stand up production-ready deployments on Render (backend) and Vercel (frontend).

---

## 1. Pre-Transfer Checklist

1. **Audit the repository** â€“ Confirm `Backend/` and `CDNC-frontend/` build cleanly with `npm install` and that all tests pass locally (see Developer Setup Guide for commands).
2. **Inventory environment variables** â€“ Capture the values currently in use (Mongo connection strings, JWT secret, SMTP credentials, analytics webhook).
3. **Decide on secrets management** â€“ Render and Vercel both support environment variable dashboards; plan where the client will store long-term credentials.
4. **Collect domain/DNS requirements** â€“ Record existing hostnames, SSL cert ownership, and email sending domains if any.

Deliver this information alongside the credentials to minimize back-and-forth after handoff.

---

## 2. Backend Migration to Render

Render will host the Express API from the `Backend/` directory.

### 2.1 Provision the Service

1. In Render, create a **Web Service** from the repository.
2. Set the **Root Directory** to `Backend` so Render installs the correct package.json.
3. Configure commands:
   * **Build Command**: `npm install`
   * **Start Command**: `npm start`

`npm start` runs `node server.js`, which connects to Mongo, syncs indexes for the `User` and `Member` models, and listens on `PORT` (default `5001`).ã€F:Backend/package.jsonâ€ L1-L12ã€‘ã€F:Backend/server.jsâ€ L3-L28ã€‘ Render automatically injects the port through `PORT`, so no code changes are required.

### 2.2 Configure Environment Variables

Add the following keys in Renderâ€™s dashboard (Environment tab):

| Variable | Purpose |
| --- | --- |
| `MONGO_URI` | MongoDB connection string consumed by `mongoose.connect`.ã€F:Backend/server.jsâ€ L13-L21ã€‘ |
| `JWT_SECRET` | Secret for signing access tokens in `utils/jwt.js`.ã€F:Backend/utils/jwt.jsâ€ L1-L13ã€‘ |
| `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`, `EMAIL_FROM`, `EMAIL_FROM_NAME` | Optional SMTP settings used when sending member confirmation emails.ã€F:Backend/utils/notifications.jsâ€ L32-L122ã€‘ |
| `ANALYTICS_WEBHOOK_URL` | Optional webhook destination triggered after successful enrollment. | 

Render encrypts values at rest, so provide production-specific secrets directly in the UI.

### 2.3 Networking & Verification

* Ensure the Render service exposes the default HTTP port and note the public hostname (e.g., `https://cdah-api.onrender.com`).
* Use the Render shell to run `curl $RENDER_SERVICE_URL/api/health` (create a simple `/api/health` route if desired) or hit `/api/members` with a test payload to verify responses.
* Check logs in Renderâ€™s dashboard: the startup log should include `âœ… MongoDB connected` and `ğŸš€ Server running` messages emitted by `server.js`.ã€F:Backend/server.jsâ€ L15-L22ã€‘

Once validated, share the Render service link and access rights with the client.

---

## 3. Frontend Migration to Vercel

Vercel will host the Vite SPA located in `CDNC-frontend/`.

### 3.1 Provision the Project

1. Create a new Vercel project from the same repository.
2. Set the **Root Directory** to `CDNC-frontend`.
3. Configure build settings:
   * **Build Command**: `npm run build`
   * **Output Directory**: `dist`

These map directly to the scripts in `package.json` where `build` runs `vite build` to emit the static bundle.ã€F:CDNC-frontend/package.jsonâ€ L1-L22ã€‘

### 3.2 Environment Variables

Define production variables under **Settings â†’ Environment Variables**:

| Variable | Value |
| --- | --- |
| `VITE_API_URL` | The public Render URL with `/api` appended (e.g., `https://cdah-api.onrender.com/api`). The axios client reads this variable at build time.ã€F:CDNC-frontend/src/lib/api.tsâ€ L1-L22ã€‘ |

Re-deploy after setting variables so the new API URL is baked into the client bundle.

### 3.3 SPA Routing

The existing `vercel.json` rewrites all routes to `index.html`, ensuring client-side routing works without 404s in production.ã€F:CDNC-frontend/vercel.jsonâ€ L1-L8ã€‘ Confirm the file is present in the root of `CDNC-frontend` before connecting the repo so Vercel applies it automatically.

### 3.4 Verification

* After deployment, browse to the Vercel preview URL and walk through join, login, and send-letter flows. The React appâ€™s providers and router are wired in `src/App.tsx`, so any hydration issues usually stem from missing environment variables.ã€F:CDNC-frontend/src/App.tsxâ€ L1-L38ã€‘
* Run the Cypress regression suite against the deployed site using `npm run test:e2e:run` with `CYPRESS_BASE_URL` overridden to the Vercel domain to confirm mission-critical journeys pass.ã€F:CDNC-frontend/package.jsonâ€ L13-L35ã€‘ã€F:CDNC-frontend/cypress.config.cjsâ€ L1-L9ã€‘

---

## 4. Coordinating Backend & Frontend URLs

1. Wait for Render to finish its first deploy and copy the live API URL.
2. Update Vercelâ€™s `VITE_API_URL` to match the Render URL plus `/api` path configured in `app.js`.ã€F:Backend/app.jsâ€ L4-L16ã€‘
3. Trigger a new Vercel deployment so the static bundle references the new API endpoint.
4. Clear browser caches when testingâ€”Vite-generated assets are hashed, but stale service workers can cache older API URLs if you add one later.

---

## 5. Final Handoff Package

Provide the client with:

1. **Deployment access** â€“ Invite their accounts to the Render and Vercel projects with appropriate roles.
2. **Runbooks** â€“ Share this handoff guide plus the Developer Setup Guide so future maintainers understand local workflows.
3. **Environment variable ledger** â€“ A secure document listing each variable, its purpose, and where it is managed.
4. **Support window** â€“ Offer a short overlap period where your team remains on-call to troubleshoot first deployments or DNS cutovers.
5. **Testing status** â€“ Attach the latest Cypress/Jest run results or badges so the client knows the codebase state at transfer time.

With these steps, the client can confidently operate the CDAH platform using Render and Vercel while retaining full control over credentials and deployments.
